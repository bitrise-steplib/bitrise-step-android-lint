format_version: "11"
default_step_lib_source: https://github.com/bitrise-io/bitrise-steplib.git

app:
  envs:
  - ORIG_BITRISE_SOURCE_DIR: $BITRISE_SOURCE_DIR
  - BITRISE_STEP_GIT_CLONE_URL: https://github.com/bitrise-steplib/bitrise-step-android-lint.git
  - MY_STEPLIB_REPO_FORK_GIT_URL: $MY_STEPLIB_REPO_FORK_GIT_URL
  - SIMPLE_REPO_GIT_CLONE_URL: https://github.com/bitrise-samples/android-multiple-test-results-sample.git
  - MONO_REPO_GIT_CLONE_URL: https://github.com/bitrise-samples/android-testing.git
  - JDK_VERSION: "11"

workflows:
  test_simple-and-mono-repo-in-src-dir:
    title: Test simple android project & mono repo projects in source dir
    steps:
    - script:
        inputs:
        - content: |
            #!/bin/bash
            rm -rf "$ORIG_BITRISE_SOURCE_DIR/_tmp"
    - change-workdir:
        title: cd $ORIG_BITRISE_SOURCE_DIR/_tmp
        run_if: true
        inputs:
        - path: $ORIG_BITRISE_SOURCE_DIR/_tmp
        - is_create_path: true
    - script:
        inputs:
        - content: |
            #!/bin/bash
            git clone $SIMPLE_REPO_GIT_CLONE_URL .
    - set-java-version@1:
        run_if: $.IsCI
        inputs:
        - set_java_version: $JDK_VERSION
    - install-missing-android-tools:
        inputs:
        - gradlew_path: ./gradlew
    - path::./:
        title: Test simple android project
        inputs:
        - arguments: --info
    - change-workdir:
        title: cd $ORIG_BITRISE_SOURCE_DIR/_tmp/mono_repo
        run_if: true
        inputs:
        - path: $ORIG_BITRISE_SOURCE_DIR/_tmp/mono_repo
        - is_create_path: true
    - script:
        inputs:
        - content: |
            #!/bin/bash
            git clone $MONO_REPO_GIT_CLONE_URL .
    - change-workdir:
        title: cd $ORIG_BITRISE_SOURCE_DIR/_tmp/mono_repo/ui/espresso/IdlingResourceSample
        run_if: true
        inputs:
        - path: $ORIG_BITRISE_SOURCE_DIR/_tmp/mono_repo/ui/espresso/IdlingResourceSample
        - is_create_path: true
    - path::./:
        title: Test monorepo
    - path::./:
        title: Test monorepo with module and variant set
        inputs:
        - module: app
        - variant: Debug

  test_simple-and-mono-repo-in-root-tmp-dir:
    title: Test simple android project & mono repo projects in /tmp dir
    steps:
    - script:
        inputs:
        - content: |
            #!/bin/bash
            rm -rf "$ORIG_BITRISE_SOURCE_DIR/_tmp"
    - change-workdir:
        title: cd $ORIG_BITRISE_SOURCE_DIR/_tmp
        run_if: true
        inputs:
        - path: $ORIG_BITRISE_SOURCE_DIR/_tmp
        - is_create_path: true
    - script:
        inputs:
        - content: |
            #!/bin/bash
            git clone $SIMPLE_REPO_GIT_CLONE_URL .
    - set-java-version@1:
        run_if: $.IsCI
        inputs:
        - set_java_version: $JDK_VERSION
    - install-missing-android-tools:
        inputs:
        - gradlew_path: ./gradlew
    - path::./:
        title: Test simple repo
    - script:
        inputs:
        - content: |
            #!/bin/bash
            rm -rf "$ORIG_BITRISE_SOURCE_DIR/_tmp"
    - change-workdir:
        title: cd $ORIG_BITRISE_SOURCE_DIR/_tmp
        run_if: true
        inputs:
        - path: $ORIG_BITRISE_SOURCE_DIR/_tmp
        - is_create_path: true
    - script:
        inputs:
        - content: |
            #!/bin/bash
            git clone $MONO_REPO_GIT_CLONE_URL .
    - change-workdir:
        title: cd $ORIG_BITRISE_SOURCE_DIR/_tmp/ui/espresso/IdlingResourceSample
        run_if: true
        inputs:
        - path: $ORIG_BITRISE_SOURCE_DIR/_tmp/ui/espresso/IdlingResourceSample
        - is_create_path: true
    - path::./:
        title: Test monorepo
